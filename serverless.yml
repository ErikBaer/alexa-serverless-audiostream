service: ${file(config/default.json):aws-profile.serviceName}
provider:
  name: aws
  region: eu-central-1
  runtime: nodejs12.x
  lambdaHashingVersion: 20201221
  stage: dev
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - dynamoDB:CreateTable
        - dynamoDB:GetItem
        - dynamoDB:PutItem
      Resource: "arn:aws:dynamodb:*:*:table/usersTable"

functions:
  alexa:
    handler: index.handler
    events:
      - alexaSkill: ${file(config/default.json):alexa.skillID}
    name: alexa-streaming-${self:provider.stage}

plugins:
  - serverless-plugin-typescript
  - serverless-alexa-skills

resources:
  Resources:
    usersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: usersTable
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1

custom:
  alexa:
    vendorId: ${file(config/default.json):alexa.credentials.vendorId}
    clientId: ${file(config/default.json):alexa.credentials.clientId}
    clientSecret: ${file(config/default.json):alexa.credentials.clientSecret}
    skills:
      - id: ${file(config/default.json):alexa.skillID}
        manifest:
          apis:
            custom:
              endpoint:
                uri: arn:aws:lambda:${self:provider.region}:${file(config/default.json):aws-profile.accountId}:function:alexa-streaming-${self:provider.stage}
              interfaces:
                - type: AUDIO_PLAYER
          manifestVersion: '1.0'
          publishingInformation:
            category: STREAMING_SERVICE
            distributionCountries: [ ]
            isAvailableWorldwide: true
            locales:
              de-DE:
                description: Streame deine liebste Radiostation - WRD2 - mit baer data!
                examplePhrases:
                  - Ã¶ffne baer data
                  - starte baer data
                keywords: [ ]
                name: baer-data
                summary: Streame deine liebste Radiostation - WRD2 - mit baer data!
                smallIconUri:  ${file(config/default.json):alexa.assets.smallIconUri}
                largeIconUri: ${file(config/default.json):alexa.assets.largeIconUri}
            testingInstructions: Sample Testing Instructions.
          privacyAndCompliance:
            allowsPurchases: false
            usesPersonalInfo: false
            isChildDirected: false
            isExportCompliant: true
            containsAds: false
            locales:
              de-DE:
                privacyPolicyUrl: http://www.myprivacypolicy.erikbaer.de
                termsOfUseUrl: http://www.termsofuse.erikbaer.de
        models:
          de-DE: ${file(models/model-deDE.json):de-model}





